# StreamDock C++ SDK æ–‡æ¡£

## 1. ğŸ“˜ æœ¬é¡¹ç›®ä»‹ç»

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº C++17 å¼€å‘çš„ SDKï¼Œæ—¨åœ¨è®©ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡ä»£ç ç›´æ¥æ§åˆ¶ Stream Dock è®¾å¤‡ã€‚

è¯¥ SDK æä¾›äº† Linux ä¸ Windows çš„è·¨å¹³å°æ”¯æŒï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªèº«çš„æ“ä½œç³»ç»Ÿé€‰æ‹©åˆé€‚çš„æ„å»ºæ–¹å¼è¿›è¡Œç¼–è¯‘å’Œä½¿ç”¨ã€‚ç›®å‰ SDK æ”¯æŒå¯¹éƒ¨åˆ†è®¾å¤‡çš„æ§åˆ¶ï¼Œä¾‹å¦‚ï¼š**293**ã€**293V3**ã€**N4**ã€**N3**ã€**N1** ç­‰å‹å·ï¼Œç”¨æˆ·å¯é€šè¿‡æŸ¥çœ‹ç¬¬äº”èŠ‚çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œå¿«é€Ÿä¸Šæ‰‹å¹¶è°ƒç”¨æˆ‘ä»¬æä¾›çš„æ¥å£å¯¹è®¾å¤‡è¿›è¡Œæ“ä½œã€‚

SDK ä¸­å¯èƒ½ä¾èµ–ä¸€äº›ç¬¬ä¸‰æ–¹åº“ï¼Œä¾‹å¦‚ï¼š

- **OpenCV**ï¼šç”¨äºå›¾åƒåŠ è½½ä¸å¤„ç†ï¼›
- **hidapi**ï¼šç”¨äº USB è®¾å¤‡çš„æ•°æ®ä¼ è¾“ä¸æ§åˆ¶ï¼›
- **giflib**ï¼šç”¨äº å¤„ç†åŠ¨æ€å›¾ç‰‡ gif çš„å¤„ç†ï¼›
- å…¶ä»–ç³»ç»Ÿç›¸å…³åº“ï¼ˆå¦‚ libudevï¼‰ã€‚

è¯·æ ¹æ®è‡ªèº«å¹³å°åŠä½¿ç”¨éœ€æ±‚ï¼Œå‚è€ƒç¬¬äºŒèŠ‚ï¼ˆLinux æ„å»ºï¼‰æˆ–ç¬¬ä¸‰èŠ‚ï¼ˆWindows æ„å»ºï¼‰ï¼Œå®‰è£…æ‰€éœ€çš„ä¾èµ–åº“å¹¶å®Œæˆæ„å»ºæµç¨‹ã€‚

---

## 2. ğŸ§ Linux æ„å»º

### 2.1 ä¾èµ–å®‰è£…

æ„å»ºæœ¬ SDK ä¹‹å‰ï¼Œè¯·ç¡®ä¿å·²å®‰è£…ä»¥ä¸‹ç³»ç»Ÿä¾èµ–é¡¹ï¼š

#### å¿…éœ€ä¾èµ–é¡¹

- **CMake**ï¼šæ„å»ºç³»ç»Ÿ
- **libudev-dev**ï¼šç”¨äºç›‘å¬ USB è®¾å¤‡æ’æ‹”ï¼ˆä»…é™ Linuxï¼‰
- **libusb-1.0-0-dev**ï¼šhidapi çš„åº•å±‚ä¾èµ–ï¼ˆä½¿ç”¨ libusb ç‰ˆæœ¬ï¼‰
- **libgif-dev**ï¼šgif å›¾åƒå¤„ç†

#### å®‰è£…å‘½ä»¤ï¼ˆé€‚ç”¨äº Ubuntu / Debianï¼‰

```bash
sudo apt update
sudo apt install build-essential cmake
sudo apt install -y libudev-dev libusb-1.0-0-dev libgif-dev
```

é™¤æ­¤ä¹‹å¤–ï¼ŒSDK è¿˜éœ€è¦ä½ å®‰è£… OpenCV åº“ã€‚

```bash
sudo apt install libopencv-dev
```

å½“ç„¶ä½ å¯ä»¥ä½¿ç”¨è£å‰ªè¿‡åçš„ `OpenCV`åº“ï¼Œå…·ä½“è£å‰ªå¯ä»¥ä½¿ç”¨ `CMake-GUI`æˆ–å‘½ä»¤è¡Œçš„æ–¹å¼è¿›è¡Œè£å‰ªï¼Œè£å‰ªçš„ç›®æ ‡æ˜¯è¯»å†™å¤§éƒ¨åˆ†çš„å›¾ç‰‡ç±»å‹å¹¶æ”¯æŒä»–ä»¬è¿›è¡Œç¼–ç è‡³ `BGR888`ã€`BGR565`ã€`jpeg`å’Œ `png`ç±»å‹ï¼Œç¡®ä¿ `SDK`æ­£å¸¸è¿è¡Œã€‚å¦‚æœä½ è§‰å¾—è£å‰ªéº»çƒ¦ï¼Œè¯·ç›´æ¥æ ¹æ®ä¸Šè¿°å‘½ä»¤ç›´æ¥å®‰è£…å³å¯ã€‚

### 2.2 æ„å»ºæ­¥éª¤

å®‰è£…å¥½ä¾èµ–é¡¹åï¼Œè¿›å…¥é¡¹ç›®ä¸»ç›®å½•ï¼Œä½ ä¼šçœ‹åˆ°å¦‚ä¸‹ç»“æ„ï¼š

```
â”œâ”€â”€ bin
â”œâ”€â”€ build
â”œâ”€â”€ cmake
â”œâ”€â”€ CMakeLists.txt
â”œâ”€â”€ ImgProcesser
â”œâ”€â”€ lib
â”œâ”€â”€ src
â””â”€â”€ third_party
```

ä½ å¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ„å»ºï¼š

```bash
chmod +x build.sh
./build.sh
```

å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå·±çš„æ–¹å¼é€šè¿‡ CMake æ„å»ºï¼Œå…·ä½“å‚æ•°å’Œé…ç½®å¯ä»¥æŸ¥çœ‹ `build.sh` è„šæœ¬å†…å®¹ï¼Œè‡ªè¡Œæ„å»ºã€‚
âš ï¸ æ„å»ºæœŸé—´å¦‚æœå‡ºç°æ‰¾ä¸åˆ° `hid_get_input_report` çš„é”™è¯¯ï¼Œè¯·å‚è€ƒç¬¬ [4.1](#41-%E7%BC%96%E8%AF%91%E6%97%B6%E6%8A%A5%E9%94%99undefined-reference-to-hid_get_input_report) èŠ‚è¿›è¡Œå¤„ç†ã€‚

### 2.3 è¿è¡Œç¤ºä¾‹

è¿›å…¥ `bin`ç›®å½•ï¼Œ ç„¶åä½¿ç”¨ç®¡ç†å‘˜æƒé™æ‰§è¡Œå³å¯ï¼Œå¦‚æœæ­¤å¤„ä½ ä¸å¸Œæœ›ä½¿ç”¨sudoï¼Œå°±éœ€è¦æŠŠä½ çš„è®¾å¤‡æ·»åŠ åˆ°ä½ çš„ç”¨æˆ·è®¾å¤‡æƒé™åˆ—è¡¨ä¸­ï¼Œå½“ç„¶ä½ å¯ä»¥ä¿®æ”¹cmakeå¯æ‰§è¡Œæ–‡ä»¶è¾“å‡ºçš„è·¯å¾„ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™ä½ éœ€è¦æ³¨æ„ä»£ç ä¸­è‡ªå·±ä¿®æ”¹çš„å›¾ç‰‡æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„

```
sudo ./main
```

---

## 3. ğŸªŸ Windows æ„å»º

### 3.1 ç¯å¢ƒè®¾ç½®

åœ¨ Windows ä¸Šï¼Œä½ ä¸éœ€è¦æ‰‹åŠ¨å®‰è£…å¤§å¤šæ•°ç¬¬ä¸‰æ–¹åº“ã€‚æˆ‘ä»¬å·²ç»é¢„ç¼–è¯‘äº†æ‰€éœ€çš„ `.dll` æ–‡ä»¶å¹¶å°†å®ƒä»¬åŒ…å«åœ¨ `bin` ç›®å½•ä¸­ã€‚

æµ‹è¯•ç¯å¢ƒï¼š

- ç¼–è¯‘å™¨ï¼šVisual Studio 17 2022
- è¯­è¨€æ ‡å‡†ï¼šC++17ï¼ˆä¹Ÿæ”¯æŒ C++20ï¼‰

å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Visual Studio 2022 ä¸”æ”¯æŒ C++17 æˆ–æ›´æ–°ç‰ˆæœ¬ï¼Œå¯ä»¥ç›´æ¥è·³è½¬åˆ°æ„å»ºè¯´æ˜ã€‚

å¦åˆ™ï¼Œè¯·é˜…è¯»æœ¬èŠ‚ä»¥è·å–æ›´å¤šæŒ‡å¯¼ã€‚

æ­¤ SDK ä»…ä½¿ç”¨ **MSVC** å·¥å…·é“¾è¿›è¡Œäº†æµ‹è¯•ã€‚æˆ‘ä»¬å»ºè®®ä½¿ç”¨ MSVC ä»¥ç¡®ä¿å®Œå…¨å…¼å®¹ã€‚

åœ¨ CMake ä¸­æŒ‡å®šç”Ÿæˆå™¨ï¼š

```bash
cmake -B build -G "Visual Studio 17 2022" -A x64
```

### ğŸ’¡ å…³äº C++ æ ‡å‡†

SDK é»˜è®¤ä½¿ç”¨ C++17ï¼Œå› ä¸ºä½¿ç”¨äº†ç°ä»£ç‰¹æ€§å¦‚ `std::filesystem`ã€‚

å¦‚æœä½ æ›´å–œæ¬¢ä½¿ç”¨ **C++14** æˆ– **C++11**ï¼Œå¯ä»¥ä¿®æ”¹ä»£ç ã€‚å¤§å¤šæ•°éœ€è¦çš„æ›´æ”¹æ¶‰åŠå°† `std::filesystem` çš„ä½¿ç”¨æ›¿æ¢ä¸ºä¼ ç»Ÿæ–‡ä»¶å¤„ç†ã€‚è¿™å¯ä»¥å¯ç”¨æ—§æ ‡å‡†ã€‚

âš ï¸ ä½¿ç”¨ MinGW æˆ–å…¶ä»–ç¼–è¯‘å™¨æ„å»ºæœªç»æµ‹è¯•ï¼Œä¸å—å®˜æ–¹æ”¯æŒã€‚

---

### 3.2 ä½¿ç”¨ CMake æ„å»º

ä½ å¯ä»¥å°†æ•´ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹ï¼ˆ`bin/` ä¸Šé¢çš„é‚£ä¸ªï¼‰æ‹–å…¥ Visual Studio 2022ã€‚

Visual Studio å°†è‡ªåŠ¨æ£€æµ‹å¹¶é…ç½® CMake é¡¹ç›®ã€‚é…ç½®å®Œæˆåï¼Œä½¿ç”¨ä»¥ä¸‹å¿«æ·é”®è¿›è¡Œæ„å»ºï¼š

- `Ctrl + B`
- `Ctrl + Shift + B`

è¾“å‡ºå¯æ‰§è¡Œæ–‡ä»¶å°†åœ¨ `bin` ç›®å½•ä¸‹ç”Ÿæˆã€‚

æˆ–è€…ï¼Œä½ å¯ä»¥ä½¿ç”¨ Visual Studio å‘½ä»¤è¡Œè¿›è¡Œæ„å»ºï¼š

> `x64 Native Tools Command Prompt for VS 2022`

åœ¨é¡¹ç›®ç›®å½•ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bat
build.bat
```

è¿™ä¹Ÿä¼šç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚

---

### 3.3 æ³¨æ„äº‹é¡¹

æˆ‘ä»¬å·²ç»é¢„ç¼–è¯‘äº†æ‰€æœ‰å¿…éœ€çš„ç¬¬ä¸‰æ–¹åº“ï¼Œå¹¶å°†å®ƒä»¬åŒ…å«åœ¨ SDK çš„ `bin` ç›®å½•ä¸­ï¼š

- `opencv_core4120.dll`
- `opencv_imgcodecs4120.dll`
- `opencv_imgproc4120.dll`
- `hidapi.dll`

æ„å»º SDK åï¼Œåªéœ€å°†è¿™äº› `.dll` æ–‡ä»¶å¤åˆ¶åˆ°ä¸å¯æ‰§è¡Œæ–‡ä»¶ç›¸åŒçš„ç›®å½•ä¸­ï¼ˆä¾‹å¦‚ `bin/`ï¼‰ï¼Œä½ å°±å¯ä»¥è¿è¡Œäº† - ä¸éœ€è¦é¢å¤–å®‰è£…ã€‚

---

## 4. ğŸ macOS æ„å»º

### 4.1 ä¾èµ–å®‰è£…

åœ¨ macOS ä¸Šï¼ŒSDK åŒ…å«ä¸º macOS é¢„æ„å»ºçš„ OpenCV åº“ã€‚åœ¨æ„å»ºä¹‹å‰ï¼Œä½ éœ€è¦å‡†å¤‡ OpenCV ä¾èµ–é¡¹ã€‚

å¯¼èˆªåˆ° `ImgProcesser/third_party` ç›®å½•å¹¶è¿è¡Œä»¥ä¸‹è„šæœ¬ä»¥åˆ›å»º OpenCV åº“çš„ç¬¦å·é“¾æ¥ï¼š

```bash
bash link_opencv_symlinks.sh
```

æ­¤è„šæœ¬å°†åœ¨ `opencv/mac/lib` ä¸­åˆ›å»ºå¿…è¦çš„ç¬¦å·é“¾æ¥ï¼Œä»¥å…è®¸ CMake æ­£ç¡®å®šä½ OpenCV åº“ã€‚

### 4.2 çƒ­æ’æ‹”æ”¯æŒ

macOS ç‰ˆæœ¬é€šè¿‡è½®è¯¢æ¨¡å¼æ”¯æŒè®¾å¤‡çƒ­æ’æ‹”æ£€æµ‹ã€‚`listen()` æ–¹æ³•ä¼šå¯åŠ¨åå°çº¿ç¨‹ï¼Œæ¯ 2 ç§’è‡ªåŠ¨æ£€æµ‹è®¾å¤‡çš„æ’å…¥å’Œæ‹”å‡ºäº‹ä»¶ï¼Œä¸ Windows å’Œ Linux å¹³å°åŠŸèƒ½ä¸€è‡´ã€‚

### 4.3 æ„å»ºæ­¥éª¤

å‡†å¤‡å¥½ä¾èµ–é¡¹åï¼Œè½¬åˆ°é¡¹ç›®æ ¹ç›®å½•ã€‚ä½ å°†çœ‹åˆ°ä»¥ä¸‹ç»“æ„ï¼š

```
â”œâ”€â”€ bin
â”œâ”€â”€ build
â”œâ”€â”€ cmake
â”œâ”€â”€ CMakeLists.txt
â”œâ”€â”€ ImgProcesser
â”œâ”€â”€ lib
â”œâ”€â”€ src
â””â”€â”€ third_party
```

è¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ„å»ºï¼š

```bash
chmod +x build.sh
./build.sh
```

ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨ä½¿ç”¨ CMake æ„å»ºã€‚æœ‰å…³é…ç½®è¯¦æƒ…ï¼Œè¯·å‚è€ƒ `build.sh`ã€‚

## 5. âš ï¸ æ•…éšœæ’é™¤

### 5.1 ç¼–è¯‘æ—¶æŠ¥é”™ï¼šundefined reference to `hid_get_input_report`

åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œå¦‚æœç³»ç»Ÿé»˜è®¤å®‰è£…çš„ `hidapi` åº“ç‰ˆæœ¬ä¸æœ¬é¡¹ç›®ä¾èµ–ä¸ä¸€è‡´ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»¥ä¸‹é“¾æ¥é”™è¯¯ï¼š

```text
/usr/bin/ld: /home/xxx/StreamDock_CppSDK/StreamDock_CppSDK/lib/libtransport.a: undefined reference to `hid_get_input_report'
collect2: error: ld returned 1 exit status
make[2]: *** [StreamDock_CppSDK/CMakeFiles/main.dir/build.make:197: /home/xxx/StreamDock_CppSDK/bin/main] Error 1
make[1]: *** [CMakeFiles/Makefile2:128: StreamDock_CppSDK/CMakeFiles/main.dir/all] Error 2
make: *** [Makefile:91: all] Error 2
```

è§£å†³æ–¹æ³•:
å…ˆæ‰¾åˆ°åˆšåˆšå®‰è£…çš„libusbåº“

```
sudo find / -name libhidapi-libusb.so.0
```

å‡è®¾è¯´æ‰¾åˆ°çš„è·¯å¾„ä¸º `/usr/lib/x86_64-linux-gnu/libhidapi-libusb.so.0`ï¼Œé‚£ä¹ˆä½ åªéœ€è¦ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œæ›¿æ¢å³å¯:

```
sudo cp ./lib/libhidapi-libusb.so.0 /usr/lib/x86_64-linux-gnu
```

### 5.2 è¿è¡Œæ—¶æ‰¾ä¸åˆ°è®¾å¤‡ `find [0] device`

å¦‚æœä½ åœ¨è¿è¡Œç¨‹åºæ—¶çœ‹åˆ°å¦‚ä¸‹æç¤ºï¼š

```text
find [0] device
```

è¯´æ˜å½“å‰æœªèƒ½æˆåŠŸè¯†åˆ«åˆ°ä»»ä½•è¿æ¥çš„è®¾å¤‡ã€‚

#### ğŸ›  å¯èƒ½åŸå› åŠè§£å†³æ–¹æ³•ï¼š

* **åœ¨ Linux ä¸‹è¿è¡Œæ—¶ç¼ºå°‘æƒé™**
  è¯·æ£€æŸ¥ä½ æ˜¯å¦ä½¿ç”¨äº† `sudo` æ¥è¿è¡Œç¨‹åºï¼š

```
sudo ./bin/main
```

* æ²¡æœ‰ç®¡ç†å‘˜æƒé™å°†å¯¼è‡´è®¾å¤‡æ— æ³•è¢«æ­£ç¡®è®¿é—®ã€‚
* **è®¾å¤‡çš„ PID / VID æœªåœ¨ SDK ä¸­æ³¨å†Œ**
  è¯·æ‰“å¼€é¡¹ç›®ä¸­çš„ `StreamDockXXX.h` æ–‡ä»¶ï¼Œæ£€æŸ¥ä½ çš„è®¾å¤‡çš„ **PIDï¼ˆProduct IDï¼‰** å’Œ **VIDï¼ˆVendor IDï¼‰** æ˜¯å¦åŒ…å«åœ¨å…¶ä¸­ã€‚
  å¦‚æœä¸åœ¨åˆ—è¡¨ä¸­ï¼Œè¯·é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼è§£å†³ï¼š
  1. è”ç³»æˆ‘ä»¬ï¼Œæˆ‘ä»¬å¯ä»¥ååŠ©ä½ æ·»åŠ è¯¥è®¾å¤‡ï¼›
  2. æˆ–è€…ä½ ä¹Ÿå¯ä»¥æ ¹æ®ç¤ºä¾‹ï¼Œè‡ªè¡Œæ¨¡ä»¿ç±»ä¸­çš„ `bool`ç±»å‹ `registerX`å˜é‡æ³¨å†Œå³å¯

æ·»åŠ å®Œæˆåé‡æ–°ç¼–è¯‘å³å¯è¯†åˆ«ã€‚

### 5.3 ä»£ç ç¼–å†™æ³¨æ„äº‹é¡¹

åœ¨è®¾ç½®è®¾å¤‡å›¾ç‰‡æ—¶ï¼ŒSDK é€šå¸¸ä¸ºæ¯ç§è®¾å¤‡æä¾›äº†ä¸¤å¥—æ¥å£å‡½æ•°ï¼š

- ä¸€ä¸ªæ˜¯ **streamæ¥å£** çš„ç‰ˆæœ¬ï¼ˆç›´æ¥ä¼ å…¥å›¾åƒæ•°æ®ï¼‰
- ä¸€ä¸ªæ˜¯ **fileæ¥å£** çš„ç‰ˆæœ¬ï¼ˆé€šè¿‡å›¾åƒæ–‡ä»¶è·¯å¾„åŠ è½½ï¼‰

æˆ‘ä»¬**å¼ºçƒˆå»ºè®®**ä¼˜å…ˆä½¿ç”¨ **fileæ¥å£** çš„ç‰ˆæœ¬ã€‚è¯¥æ–¹å¼æ›´å®‰å…¨ã€æ›´ç¨³å®šï¼Œé€‚ç”¨äºå¤§å¤šæ•°å¹³å°å’Œè®¾å¤‡ã€‚

#### âš ï¸ å…³äº `streamæ¥å£` çš„æ¥å£å‡½æ•°

- è¿™äº›å‡½æ•°ä¸»è¦ç”¨äºå…¼å®¹ä¸€äº›ç¬¬ä¸‰æ–¹å›¾åƒå¤„ç†åº“ï¼ˆå¦‚ä½ è‡ªå·±è¯»å–å¹¶å¤„ç†å›¾åƒå†…å­˜æ•°æ®çš„åœºæ™¯ï¼‰ï¼›

#### âš ï¸ ä½¿ç”¨ `streamæ¥å£` æ¥å£å­˜åœ¨çš„é£é™©

ä½¿ç”¨ **streamæ¥å£**éœ€è¦æå…¶å°å¿ƒï¼Œå¦‚æœå‚æ•°å¡«å†™ä¸å½“ï¼Œå¯èƒ½å¯¹è®¾å¤‡é€ æˆè¾ƒå¤§ï¼Œä¸¥é‡çš„éœ€è¦è¿”å‚é‡æ–°çƒ§å½•å›ºä»¶ç¨‹åºï¼Œä¾‹å¦‚ï¼š

- å›¾åƒæ•°æ®è¶Šç•Œå¯¼è‡´è®¾å¤‡å†…éƒ¨å¡æ­»
- å›¾åƒå¤§å°/æ ¼å¼é”™è¯¯å¯¼è‡´å†™å…¥å¤±è´¥

å› æ­¤ï¼Œ**è¯·åŠ¡å¿…è®¤çœŸé˜…è¯» `streamdock.h` ä¸­ç›¸å…³å‡½æ•°çš„æ³¨é‡Šè¯´æ˜**ï¼Œç¡®ä¿ç†è§£æ¯ä¸ªå‚æ•°çš„å«ä¹‰åŠä½¿ç”¨æ–¹å¼ã€‚

é”™è¯¯ä½¿ç”¨æ­¤æ¥å£ï¼Œåæœè‡ªè´Ÿã€‚

### 5.4 æ–°æ—§å¹³å°ä¹‹é—´çš„å·®å¼‚

æ‰€è°“æ–°æ—§å¹³å°ï¼Œå…¶å®æŒ‡çš„æ˜¯è®¾å¤‡æ‰€ä½¿ç”¨çš„å›ºä»¶ç¨‹åºç‰ˆæœ¬çš„ä¸åŒã€‚

ä½ ä¸éœ€è¦äº†è§£è¿‡å¤šæŠ€æœ¯ç»†èŠ‚ï¼Œåªéœ€çŸ¥é“ä»¥ä¸‹å‡ ç‚¹ï¼š

- åœ¨æœ¬ SDK ä¸­ï¼Œ**åªæœ‰ 293ï¼ˆåŒ…æ‹¬ 293sï¼‰æ˜¯æ—§å¹³å°è®¾å¤‡**ï¼›
- **N3ã€293V3ã€N4 å‡å±äºæ–°å¹³å°è®¾å¤‡**ã€‚

#### ğŸ” æ“ä½œè¡Œä¸ºå·®å¼‚

æ–°æ—§å¹³å°åœ¨æ¥å£ä½¿ç”¨ä¸Šçš„å·®å¼‚å¹¶ä¸å¤§ï¼Œä½†å®ƒä»¬åœ¨è¿è¡Œè¡¨ç°ä¸Šçš„åŒºåˆ«è¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ç‚¹ï¼š

- **æ‰§è¡Œé€Ÿåº¦**ï¼šæ–°å¹³å°è®¾å¤‡çš„å“åº”é€Ÿåº¦æ˜æ˜¾ä¼˜äºæ—§å¹³å°ï¼›
- **åŒæ­¥ / å¼‚æ­¥æ‰§è¡Œ**ï¼š
  - æ–°å¹³å°æ”¯æŒ**è®¾å¤‡å¼‚æ­¥æ‰§è¡Œå‘½ä»¤**ï¼Œå³åœ¨è¯»å–è¿”å›ä¿¡æ¯çš„åŒæ—¶è¿˜èƒ½æ‰§è¡Œå…¶ä»–æ“ä½œï¼›
  - æ—§å¹³å°ï¼ˆå¦‚ 293ï¼‰åˆ™ä¸æ”¯æŒå¼‚æ­¥ï¼Œæ‰€æœ‰å‘½ä»¤å¿…é¡»**ä¸²è¡Œæ‰§è¡Œï¼ˆåŒæ­¥ï¼‰**ï¼›
- **ç­‰å¾…ä¸é˜»å¡**ï¼š
  - æ—§å¹³å°åœ¨å¾ˆå¤šæ“ä½œä¸­éœ€è¦é¢å¤–çš„é˜»å¡ç­‰å¾…ï¼›
  - æ–°å¹³å°åªæœ‰åœ¨ä¸ªåˆ«æ“ä½œä¸­éœ€è¦ç­‰å¾…ï¼Œå¤§å¤šæ•°æ“ä½œå¯ä»¥è¿ç»­å¿«é€Ÿæ‰§è¡Œã€‚

#### ğŸ’¡ ROM ä¸ RAM æ“ä½œå·®å¼‚

- `setBackgroundImgFile()` â€”â€” è®¾ç½®å¼€æœºèƒŒæ™¯å›¾ï¼Œå†™å…¥çš„æ˜¯è®¾å¤‡çš„ **ROM**ï¼š
  - å†™å…¥é€Ÿåº¦è¾ƒæ…¢ï¼›
  - ä½†é‡å¯åä»ç„¶ä¿ç•™ï¼›
- `setKeyImgFile()` â€”â€” è®¾ç½®æŒ‰é”®å›¾æ ‡ï¼Œå†™å…¥çš„æ˜¯è®¾å¤‡çš„ **RAM**ï¼š
  - å†™å…¥é€Ÿåº¦è¾ƒå¿«ï¼›
  - ä½†æ–­ç”µåä¼šä¸¢å¤±ï¼Œéœ€é‡æ–°è®¾ç½®ã€‚

> âš ï¸ å› æ­¤åœ¨ä½¿ç”¨æ—§å¹³å°è®¾å¤‡æ—¶ï¼Œè¯·æ ¼å¤–æ³¨æ„å‘½ä»¤æ‰§è¡Œçš„æ—¶æœºä¸èŠ‚å¥ï¼Œé¿å…å› å¹¶å‘è°ƒç”¨å¯¼è‡´è®¾å¤‡å“åº”å¼‚å¸¸ã€‚

---

## 6. ğŸ§ª ä½¿ç”¨ç¤ºä¾‹

æœ¬èŠ‚æä¾›ä¸€ä¸ªå®Œæ•´çš„ SDK ä½¿ç”¨ç¤ºä¾‹ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

- æšä¸¾è®¾å¤‡
- å”¤é†’å±å¹•ï¼Œè®¾ç½®äº®åº¦
- è®¾ç½®èƒŒæ™¯å›¾ç‰‡
- è®¾ç½®æŒ‰é”®å›¾ç‰‡

---

### 6.1 è®¾ç½®èƒŒæ™¯å›¾ç‰‡

```cpp
device->setEncoder(std::make_shared<OpenCVImageEncoder>());  // åœ¨è°ƒç”¨å…³è”å›¾ç‰‡æ“ä½œçš„æ¥å£æ—¶, å‰æå¿…é¡»è®¾ç½®ç¼–ç å™¨
device->setBackgroundImgFile("YiFei.jpg");                   // è®¾ç½®å¼€æœº logo ä¸ºè·¯å¾„ ./YiFei.jpg çš„é™æ€å›¾ç‰‡
device->refresh();
```

ä½¿ç”¨æœ¬åœ°å›¾ç‰‡è·¯å¾„è®¾ç½®èƒŒæ™¯å›¾ã€‚æ¨èä½¿ç”¨è¯¥æ–¹å¼ï¼Œç®€å•å®‰å…¨ã€‚

### 6.2 è®¾ç½®æŒ‰é”®å›¾ç‰‡

```cpp
device->setEncoder(std::make_shared<OpenCVImageEncoder>());  // åœ¨è°ƒç”¨å…³è”å›¾ç‰‡æ“ä½œçš„æ¥å£æ—¶, å‰æå¿…é¡»è®¾ç½®ç¼–ç å™¨
device->setKeyImgFile("YiFei.jpg", 9);                       // åœ¨æŒ‰é”® 9 çš„ä½ç½®è®¾ç½®è·¯å¾„ä¸º ./YiFei.jpg çš„é™æ€å›¾ç‰‡
device->refresh();
```

ä¸ºç¬¬ 9 ä¸ªæŒ‰é”®ä½ç½®è®¾ç½®å›¾ç‰‡ï¼Œä½¿ç”¨æœ¬åœ°æ–‡ä»¶è·¯å¾„ã€‚

### 6.3 è®¾ç½®æŒ‰é”®åŠ¨å›¾ï¼ˆå¿…é¡»æ˜¯ `bool isDualDevice = true;`ï¼‰

```cpp
device->setEncoder(std::make_shared<OpenCVImageEncoder>());  // åœ¨è°ƒç”¨å…³è”å›¾ç‰‡æ“ä½œçš„æ¥å£æ—¶, å‰æå¿…é¡»è®¾ç½®ç¼–ç å™¨
device->gifer()->setKeyGifFile("1.gif", 1);                  // åœ¨æŒ‰é”® 1 çš„ä½ç½®è®¾ç½®è·¯å¾„ä¸º ./1.gif çš„åŠ¨æ€å›¾ç‰‡
device->gifer()->startGifLoop();                             // å¯åŠ¨ gif å‘é€çº¿ç¨‹
```

### 6.4 è®¾ç½®æŒ‰é”®åé¦ˆå›è°ƒå¤„ç†

```cpp
device->reader()->startReadLoop();  // è°ƒç”¨æ³¨å†ŒæŒ‰é”®è¯»å‡½æ•°å‰æˆ–å, å¿…é¡»å¼€å¯è¯»å¾ªç¯, å¦åˆ™ä¸ä¼šå¤„ç†ä»»ä½•æ¶ˆæ¯
// æ­¤å¤„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ³¨å†Œçš„æŒ‰é”®å®é™…å€¼, éœ€è¦æŸ¥æ‰¾è¿™ä¸ªå€¼çš„ä½ éœ€è¦å»`HotspotDevice/StreamDockXXX.cpp`é‡Œé¢æŸ¥æ‰¾`_readValueMap`ä¸­çš„`key`å€¼
device->reader()->registerReadCallback(11, []()
		{ ToolKit::print("Key 11 pressed"); }, RegisterEvent::EveryThing);
```

### 6.5 ä¸»å‡½æ•°å…¥å£ï¼šè®¾å¤‡æšä¸¾ä¸è°ƒç”¨æµ‹è¯•å‡½æ•°

```cpp
ToolKit::disable_output = false;         // ç¦ç”¨å½“å‰ sdk ToolKitæ‰“å°
StreamDock::disableOutput(false);        // å¯åŠ¨ Transport åº“å†…éƒ¨æ‰“å°
DeviceManager::instance().enumerator();  // æšä¸¾å½“å‰å¯è¿æ¥çš„ StreamDock è®¾å¤‡
// ç›‘å¬è®¾å¤‡çƒ­æ’æ‹”ï¼Œå¹¶è®¾ç½®å…¶è¿æ¥å›è°ƒå¤„ç†
DeviceManager::instance().listen([](std::shared_ptr<StreamDock> device) {
	doSomething(device);                   // çƒ­æ’è®¾å¤‡å, ä¼šè§¦å‘æ­¤å¤„ dosomething å‡½æ•°
	});
auto& streamdocks = DeviceManager::instance().getStreamDocks(); // è·å–å½“å‰å¯è¿æ¥çš„æ‰€æœ‰ StreamDock è®¾å¤‡åˆ—è¡¨
for (const auto& device : streamdocks) {
	try {
		doSomething(device.second);
	}
	catch (...) {
		std::cerr << "something error" << std::endl;
	}
}
```

ğŸ–¼ï¸ ç¤ºä¾‹å›¾åƒæ–‡ä»¶è¯·æ”¾ç½®äº `bin/img` ç›®å½•ä¸‹ã€‚
è‹¥å‡ºç°æ‰¾ä¸åˆ°è®¾å¤‡ï¼Œè¯·å‚è€ƒ [4.2 è¿è¡Œæ—¶æ‰¾ä¸åˆ°è®¾å¤‡](#42-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%89%BE%E4%B8%8D%E5%88%B0%E8%AE%BE%E5%A4%87-find-0-device)

#### ğŸ” å‡½æ•°è¯´æ˜

- `open(AUTOREAD)`
  å¿…é¡»åœ¨ä½¿ç”¨è®¾å¤‡å‰è°ƒç”¨ã€‚
  `AUTOREAD` å¯ç”¨è‡ªåŠ¨ç›‘å¬äº‹ä»¶ï¼Œä¾‹å¦‚ï¼š

  - æŒ‰é”®æŒ‰ä¸‹
  - å›¾åƒæ›´æ–°æˆåŠŸ
    è¦åœæ­¢è‡ªåŠ¨è¯»å–ï¼š

  ```cpp
  Transport::stopAutoRead();
  ```
- `init()`
  æ­¤å‡½æ•°ä½œä¸ºä¸€ä¸ªä¸€ä½“åŒ–æ¥å£ï¼Œç”¨äºè‡ªåŠ¨å”¤é†’ã€æ¸…é™¤å±å¹•ã€è®¾ç½®äº®åº¦å’Œåˆ·æ–°ã€‚
  é€šå¸¸åœ¨ `open()` å‡½æ•°åä½¿ç”¨ã€‚
- `asyncListen()`
  å¯åŠ¨åå°çº¿ç¨‹æ¥ç›‘æ§è®¾å¤‡æ’æ‹”ã€‚
  å®ƒå†…éƒ¨è°ƒç”¨ `DeviceManager::listen()`ã€‚
- `joining_thread` ç±»
  è¿™ä¸ªç±»åœ¨å½“å‰ä½œç”¨åŸŸå†…è‡ªåŠ¨ join æ–°åˆ›å»ºçš„çº¿ç¨‹ï¼Œä½¿ä½ æ— éœ€æ‰‹åŠ¨ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚
- `listen(bool autoReconnect = false)`
  å¦‚æœ `autoReconnect = true`ï¼Œå®ƒä¼šåœ¨æ’å…¥æ—¶è‡ªåŠ¨è°ƒç”¨ `open()` å’Œ `wakeScreen()`ã€‚
  ä½ å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®æ·»åŠ è‡ªå®šä¹‰é‡è¿é€»è¾‘ï¼š

  ```cpp
  // åœ¨è¿™é‡Œé‡æ–°è¿æ¥å¹¶æ‰§è¡ŒæŸäº›æ“ä½œï¼Œæ¯”å¦‚å¯åŠ¨ä¿¡å·è°ƒç”¨å‡½æ•°
  ```

âœ… æˆ‘ä»¬å»ºè®®åœ¨å¯åŠ¨æ—¶è°ƒç”¨ `asyncListen()` æ¥ç›‘æ§å®æ—¶è®¾å¤‡å˜åŒ–ã€‚

---

## 7. ğŸ†• æœ€æ–°æ›´æ–°

### ç‰ˆæœ¬ 1.0.2 - 2025-11-18

#### æ–°å¢åŠŸèƒ½

- æ–°å¢è®¾å¤‡æ”¯æŒï¼šXL ,M3 ,N3ç³»åˆ—, M18;

#### ä¾èµ–æ›´æ–°

- C++17 åŠä»¥ä¸Šæ ‡å‡†
- [hidapi](https://github.com/libusb/hidapi) `v0.14.0`
- [libusb-1.0](https://libusb.info/) `v1.0.27`
- [libudev](https://github.com/systemd/systemd) `v245`ï¼ˆç”¨äº Linux è®¾å¤‡ç›‘å¬ï¼‰

---

## 8. ğŸ” è®¾å¤‡å…·ä½“ä½¿ç”¨åŠå¿«é€Ÿä¸Šæ‰‹

è¯·å‚è€ƒ `src/test.h`æ–‡ä»¶ï¼Œæœ¬SDKæœ€ç®€å•çš„ç”¨æ³•å°±æ˜¯ç›´æ¥è·Ÿç€è¯¥æ–‡ä»¶çš„å¯¹åº”çš„è®¾å¤‡è¿›è¡Œä¿®æ”¹å³å¯
